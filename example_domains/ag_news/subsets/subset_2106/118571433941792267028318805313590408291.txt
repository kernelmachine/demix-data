Plans by Microsoft Corp to charge royalties on a library of patents are looking uncertain after the US Patent and Trademark Office rejected a key software patent claimed by the company.