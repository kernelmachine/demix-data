Sudan has failed to end militia attacks on civilians in Darfur,  while rebels also broke a truce, a UN envoy says.